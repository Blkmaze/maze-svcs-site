trigger:
  branches:
    include:
      - master

pool:
  name: Default

steps:
- task: NodeTool@0
  inputs:
    versionSpec: '18.x'
  displayName: 'ğŸ§ª Install Node.js'

- script: npm install
  displayName: 'ğŸ“¦ Install dependencies'
  workingDirectory: DevOpsSecOpsTraining/node-vuln-demo

- script: npm test
  displayName: 'âœ… Run tests'
  workingDirectory: DevOpsSecOpsTraining/node-vuln-demo

- script: npm install -g snyk
  displayName: 'ğŸ” Install Snyk'

- script: snyk auth $(SNYK_TOKEN)
  displayName: 'ğŸ” Authenticate Snyk'

- script: snyk test
  displayName: 'ğŸš¨ Run Snyk scan'
  workingDirectory: DevOpsSecOpsTraining/node-vuln-demo
